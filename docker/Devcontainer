FROM ghcr.io/bython-talk/bython-catch3:latest AS catch3-dev
WORKDIR /

FROM catch3-dev AS lexy-catch3-dev

WORKDIR /
RUN wget https://github.com/foonathan/lexy/archive/refs/tags/v2022.12.1.zip -O /lexy.zip && unzip /lexy.zip -d /lexy

WORKDIR /lexy/lexy-2022.12.1/
RUN cmake -E make_directory build

WORKDIR /lexy/lexy-2022.12.1/build
RUN cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_LIBDIR=/usr/lib/ \
    -DLEXY_BUILD_BENCHMARKS=OFF \
    -DLEXY_BUILD_EXAMPLES=OFF \
    -DLEXY_BUILD_TESTS=OFF \
    -DLEXY_BUILD_DOCS=OFF \
		-DLEXY_BUILD_PACKAGE=OFF \
		-DLEXY_ENABLE_INSTALL=ON \
    /lexy/lexy-2022.12.1

RUN cmake --build . -j4
RUN cmake --install .

FROM lexy-catch3-dev AS bython-dev

WORKDIR /
RUN apt update && apt install -qq -y gdb clang-format cppcheck ninja-build libxml2-dev gzip && apt-get clean all

ENTRYPOINT [ "/bin/sh" ]
